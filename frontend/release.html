<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lire un message sécurisé</title>
  <style>
    :root {
      --primary-color: #00d975;
      --primary-dark: #039c55;
      --background: #f5f5f5;
      --surface: #ffffff;
      --border-radius: 8px;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      background-color: var(--background);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      background-color: var(--surface);
      padding: 2rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 400px;
    }

    h2 {
      margin-top: 0;
      color: var(--primary-color);
      text-align: center;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #002B29;
    }

    input {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1.5rem;
      border: 1px solid #ccc;
      border-radius: var(--border-radius);
      font-size: 1rem;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      padding: 0.75rem;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: var(--primary-dark);
    }

    .message {
      margin-top: 1rem;
      padding: 1rem;
      background-color: #e8f5e9;
      border: 1px solid #c8e6c9;
      border-radius: var(--border-radius);
      color: #2e7d32;
      font-weight: bold;
      white-space: pre-wrap;
    }

    .error {
      margin-top: 1rem;
      padding: 1rem;
      background-color: #ffebee;
      border: 1px solid #ffcdd2;
      border-radius: var(--border-radius);
      color: #c62828;
      font-weight: bold;
    }

    .countdown {
      margin-top: 1rem;
      font-weight: bold;
      color: #555;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Lire un message sécurisé</h2>
    <form id="releaseForm">
      <label for="password">Mot de passe</label>
      <input type="password" id="password" name="password" required />

      <button type="submit">Afficher le message</button>
    </form>
    <div id="output"></div>
  </div>

<script>
  const form = document.getElementById("releaseForm");
  const output = document.getElementById("output");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    const password = document.getElementById("password").value;
    const id = window.location.pathname.split("/").pop();

    const response = await fetch(`/release/${id}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ password })
    });

    const data = await response.json();
    output.innerHTML = "";

    if (data.content) {
      const msg = document.createElement("div");
      msg.className = "message";
      msg.textContent = data.content;
      output.appendChild(msg);

      if (data.expiresAt) {
        const countdown = document.createElement("div");
        countdown.className = "countdown";

        function updateCountdown() {
          const now = new Date();
          const expire = new Date(data.expiresAt);
          const diff = Math.max(0, expire - now);
          const minutes = Math.floor(diff / 60000);
          const seconds = Math.floor((diff % 60000) / 1000);
          countdown.textContent = `Expire dans : ${minutes}m ${seconds}s`;
        }

        updateCountdown();
        setInterval(updateCountdown, 1000);
        output.appendChild(countdown);
      }
    } else {
      const err = document.createElement("div");
      err.className = "error";
      err.textContent = data.error || "Erreur inconnue";
      output.appendChild(err);
    }
  });
</script>

</body>
</html>
